{% extends "base.html" %}
{% block title %}Dashboard — ICC MES AutoTrader{% endblock %}
{% block nav_dashboard %}active{% endblock %}

{% block content %}
<div class="controls">
    <button id="btn-start" class="btn btn-green" onclick="startSession()">Start Simulated</button>
    <button id="btn-start-live" class="btn btn-green" onclick="startLiveSession()" style="background:#ff6600;">Start Live</button>
    <button id="btn-stop" class="btn btn-yellow" onclick="stopSession()" disabled>Stop Session</button>
    <button id="btn-kill" class="btn btn-red" onclick="killSession()">KILL SWITCH</button>
    <span id="session-status" class="session-badge idle">IDLE</span>
    <span id="session-mode" class="session-badge" style="display:none;"></span>
</div>

<div class="grid-4">
    <!-- Panel 1: FSM State -->
    <div class="panel">
        <div class="panel-header">FSM State</div>
        <div class="panel-body">
            <div id="fsm-state" class="big-text">FLAT</div>
            <div class="sub-text">Candles: <span id="candle-count">0</span></div>
        </div>
    </div>

    <!-- Panel 2: P&L -->
    <div class="panel">
        <div class="panel-header">P&amp;L</div>
        <div class="panel-body">
            <div id="daily-pnl" class="big-text pnl-zero">$0.00</div>
            <div class="sub-text">Trades: <span id="trade-count">0</span></div>
        </div>
    </div>

    <!-- Panel 3: Position -->
    <div class="panel">
        <div class="panel-header">Position</div>
        <div class="panel-body">
            <div id="position-info" class="position-flat">FLAT</div>
            <div class="sub-text">
                <span id="pos-entry">—</span> |
                Stop: <span id="pos-stop">—</span> |
                Target: <span id="pos-target">—</span>
            </div>
            <div class="sub-text">Unrealized: <span id="pos-upnl">$0.00</span></div>
        </div>
    </div>

    <!-- Panel 4: Last Candle -->
    <div class="panel">
        <div class="panel-header">Last Candle</div>
        <div class="panel-body">
            <div id="candle-time" class="sub-text">—</div>
            <div class="candle-grid">
                <span class="label">O</span><span id="candle-open">—</span>
                <span class="label">H</span><span id="candle-high">—</span>
                <span class="label">L</span><span id="candle-low">—</span>
                <span class="label">C</span><span id="candle-close">—</span>
                <span class="label">V</span><span id="candle-vol">—</span>
            </div>
        </div>
    </div>
</div>

<!-- Alerts Feed -->
<div class="panel alerts-panel">
    <div class="panel-header">Event Log</div>
    <div class="panel-body">
        <div id="alerts-feed" class="alerts-feed"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/ws.js"></script>
{% endblock %}
